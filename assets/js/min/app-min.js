/*
* @Author: SirMrE
* @http: http://www.sirmre.com/bdo-calculator
* @Copyright: (c) 2016 Mark Eliasen
* @license: May be freely distributed under the CC BY-NC 3.0 License 
*           (https://creativecommons.org/licenses/by-nc/3.0/)
* @Date:   2016-04-07 20:53:22
* @Last Modified by:   SirMrE
* @Last Modified time: 2016-11-17 12:19:33
*/
!function($){"use strict";function e(e){e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","i"),t=a.exec(window.location.href);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}function a(e,a){var t=BDOcalculator.gear.helmet.gems[a].gem_name,s=Object.keys(BDOdatabase.gems.helmet),n=Object.keys(BDOdatabase.gems.all);return t&&n.indexOf(t)!==-1?"a"+n.indexOf(t):s.indexOf(t)}function t(){var e=[BDOdatabase.classes.indexOf(i(m)),[Object.keys(BDOdatabase.items.helmets).indexOf(BDOcalculator.gear.helmet.item_name),parseInt(BDOcalculator.gear.helmet.enhancement),[a("helmet","1"),a("helmet","2")]],[Object.keys(BDOdatabase.items.armor).indexOf(BDOcalculator.gear.armor.item_name),parseInt(BDOcalculator.gear.armor.enhancement),[a("armor","1"),a("armor","2")]],[Object.keys(BDOdatabase.items.shoes).indexOf(BDOcalculator.gear.shoes.item_name),parseInt(BDOcalculator.gear.shoes.enhancement),[a("shoes","1"),a("shoes","2")]],[Object.keys(BDOdatabase.items.gloves).indexOf(BDOcalculator.gear.gloves.item_name),parseInt(BDOcalculator.gear.gloves.enhancement),[a("gloves","1"),a("gloves","2")]],[[Object.keys(BDOdatabase.items.rings).indexOf(BDOcalculator.gear.rings[1].item_name),parseInt(BDOcalculator.gear.rings[1].enhancement)],[Object.keys(BDOdatabase.items.rings).indexOf(BDOcalculator.gear.rings[2].item_name),parseInt(BDOcalculator.gear.rings[2].enhancement)]],[[Object.keys(BDOdatabase.items.earrings).indexOf(BDOcalculator.gear.earrings[1].item_name),parseInt(BDOcalculator.gear.earrings[1].enhancement)],[Object.keys(BDOdatabase.items.earrings).indexOf(BDOcalculator.gear.earrings[2].item_name),parseInt(BDOcalculator.gear.earrings[2].enhancement)]],[Object.keys(BDOdatabase.items.belts).indexOf(BDOcalculator.gear.belt.item_name),parseInt(BDOcalculator.gear.belt.enhancement)],[Object.keys(BDOdatabase.items.necklaces).indexOf(BDOcalculator.gear.necklace.item_name),parseInt(BDOcalculator.gear.necklace.enhancement)],[Object.keys(BDOdatabase.items["main-weapons"][m]).indexOf(BDOcalculator.gear["main-weapon"].item_name),parseInt(BDOcalculator.gear["main-weapon"].enhancement),[a("main-weapon","1"),a("main-weapon","2")]],[Object.keys(BDOdatabase.items["secondary-weapons"][m]).indexOf(BDOcalculator.gear["secondary-weapon"].item_name),parseInt(BDOcalculator.gear["secondary-weapon"].enhancement),[a("secondary-weapon","1"),a("secondary-weapon","2")]]],t=window.location.href.replace(window.location.search,"");$("#share-link").val(t+(t.indexOf("?")===-1?"?":"&")+"gear="+JSON.stringify(e))}function s(a){var t=e("gear"),s=["class","helmet","armor","shoes","gloves","rings","earrings","belt","necklace","main-weapon","secondary-weapon"];if(a="undefined"!=typeof a?a:function(e){},null===t)return void a(!1);if(t=JSON.parse(t),$.inArray(i(BDOdatabase.classes[t[0]]),BDOdatabase.classes)===-1)return void a(!1);m=BDOdatabase.classes[t[0]].toLowerCase(),BDOcalculator.init();for(var n=t.length-1,r=1;r<=n;r++){var o=s[r],d=o,l=o+("armor"===o?"":"s"!==o.slice(-1)?"s":""),p=BDOdatabase.items[l],f=Object.keys(p),g="",u;if(t[r][0]!==-1)if("rings"===d||"earrings"===d)for(var O=1;O>=0;O--)g=f[t[r][O][0]],""!==g&&"undefined"!=typeof g&&c(g,d.slice(0,-1),d,O+1,t[r][O][1],!1);else{if(g="main-weapon"===d||"secondary-weapon"===d?Object.keys(p[m])[t[r][0]]:f[t[r][0]],""===g||"undefined"==typeof g)continue;if(c(g,d,l,u,t[r][1],!1),$.inArray(d,["belt","necklace"])===-1&&t[r][2].length)for(var b=Object.keys(BDOdatabase.gems[d]),v=Object.keys(BDOdatabase.gems.all),O=1;O>=0;O--)t[r][2][O]!==-1&&("number"==typeof t[r][2][O]&&(g=b[t[r][2][O]]),"string"==typeof t[r][2][O]&&(g=v[parseInt(t[r][2][O].replace("a",""))]),""!==g&&"undefined"!=typeof g&&c(g,d,"gems",O+1,null,!1))}}a(!0)}function n(e){var a=Object.keys(e.enhancement).length;return a>0&&a>BDOdatabase.max_gear_enhancement&&(a=BDOdatabase.max_gear_enhancement),a}function i(e){return e.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()})}function r(e,a){$("#equipment .gear-slot[data-type='"+e+"']"+("undefined"==typeof a?"":"[data-item='"+a+"']")).attr("style",""),$("#equipment .gem-slot."+e+"1, .gem-slot."+e+"2").attr("style","").hide()}function o(e,a,t,s){if(t="undefined"==typeof t?"undefined":t,"gems"!==s?$("#equipment .gear-slot[data-type='"+a+"']"+("undefined"===t?"":"[data-item='"+t+"']")).css({"border-color":BDOdatabase.rarities[e.rarity],background:"url(assets/images/48/"+($.inArray(a,["main-weapon","secondary-weapon"])===-1?a:BDOdatabase.class_weapons[m][a].replace(" ","-").toLowerCase())+".png) no-repeat center center"}):$("#equipment .gem-slot[data-type='"+a+"'][data-item='"+t+"']").css({"border-color":BDOdatabase.rarities[e.rarity]}),$.inArray(a,["main-weapon","secondary-weapon","armor","shoes","gloves","helmet"])!==-1&&"gems"!==s&&($("#equipment .gem-slot."+a+"1, #equipment .gem-slot."+a+"2").hide(),e.gems>0))for(var n,i=e.gems;i>0;i--)""!==BDOcalculator.gear[a].gems[i].gem_name?(n=BDOcalculator.gear[a].gems[i].gem,$("#equipment .gem-slot."+a+i).css({"border-color":BDOdatabase.rarities[n.rarity]}).show()):$("#equipment .gem-slot."+a+i).attr("style","").show()}function c(e,a,s,n,i,r){var c="gems"===s?BDOdatabase.gems:BDOdatabase.items[s];r="undefined"==typeof r||r,"gems"!==s?$.inArray(a,["main-weapon","secondary-weapon"])!==-1&&(c=c[m.toLowerCase()]):c="undefined"==typeof c[a][e]?c.all:c[a],c=c[e],BDOcalculator.setGear(c,a,n,e,s,function(){o(c,a,n,s),"gems"!==s?BDOcalculator.setEnchantmentLevel(a,n,i,function(){r&&BDOcalculator.calculate()}):r&&BDOcalculator.calculate(),r&&t()})}function d(e,a,t,s,n,i){n="undefined"==typeof n?1:n;var r=$('<div class="item-details '+(i?" selected ":"")+"col-md-10 col-md-offset-"+(n%2===0?"2":"1")+'"/>'),o;if(r.append('<div class="item-name"><strong style="color: '+BDOdatabase.rarities[e.rarity]+'">'+s+"</strong></div>"),r.append('<div class="item-icon"><img src="assets/images/48/gem.png" alt="BDO Gear Calculator"></div>'),r.append('<button class="btn btn-sm btn-primary item-choose" data-item="'+s+'" data-itemset="gems" data-type="'+a+'" data-itemno="'+t+'">Choose</button>'),o=$('<div class="item-effects"/>'),o.append("<strong>Item Effects</strong>"),Object.keys(e.item_effects).length>0)for(var c in e.item_effects)e.item_effects.hasOwnProperty(c)&&("special"===c?o.append("<strong>"+BDOdatabase.stats[c].title+":</strong><div>"+e.item_effects.special+"</div>"):o.append("<div>"+BDOdatabase.stats[c].title+" "+e.item_effects[c]+BDOdatabase.stats[c].symbol+"</div>"));else o.append("<div>None.</div>");if(o.appendTo(r),e.incompatible.length>0){o=$('<div class="item-effects"/>'),o.append("<strong>It doesn't stack with:</strong>");for(var d=e.incompatible.length-1;d>=0;d--)o.append("<div>"+e.incompatible[d]+"</div>");o.appendTo(r)}return r}function l(e,a,t,s,r,o,c){o="undefined"==typeof o?1:o;var d=$('<div class="item-details '+(c?" selected ":"")+"col-md-10 col-md-offset-"+(o%2===0?"2":"1")+'"/>'),l,p=0;if($.inArray(a,["ring","earring"])!==-1?BDOcalculator.gear[a+"s"][s].item_name===r&&(p=BDOcalculator.gear[a+"s"][s].enhancement):BDOcalculator.gear[a].item_name===r&&(p=BDOcalculator.gear[a].enhancement),d.append('<div class="item-name"><strong style="color: '+BDOdatabase.rarities[e.rarity]+'">'+r+"</strong></div>"),d.append('<div class="item-icon"><img src="assets/images/48/'+($.inArray(a,["main-weapon","secondary-weapon"])===-1?a:BDOdatabase.class_weapons[m][a].replace(" ","-").toLowerCase())+'.png" alt="BDO Gear Calculator"></div>'),l=$('<div class="item-stats"/>'),"undefined"!=typeof e.ap&&l.append("<div>AP: "+BDOcalculator.getItemStat(e,"ap",!1,p)+"</div>"),"undefined"!=typeof e.ap_min&&l.append("<div>AP: "+BDOcalculator.getItemStat(e,"ap_min",!1,p)+"~"+BDOcalculator.getItemStat(e,"ap_max",!1,p)+"</div>"),"undefined"!=typeof e.dp&&l.append("<div>DP: "+BDOcalculator.getItemStat(e,"dp",!1,p)+"</div>"),l.appendTo(d),d.append('<button class="btn btn-sm btn-primary item-choose" data-enh="'+p+'" data-item="'+r+'" data-itemset="'+t+'" data-type="'+a+'" data-itemno="'+s+'">Choose</button>'),d.append('<div class="item-gems"><strong>Gem Slots:</strong><div>'+e.gems+"</div></div>"),l=$('<div class="item-effects"/>'),l.append("<strong>Item Effects</strong>"),Object.keys(e.item_effects).length>0)for(var f in e.item_effects)e.item_effects.hasOwnProperty(f)&&("special"===f?l.append("<strong>"+BDOdatabase.stats[f].title+":</strong><div>"+e.item_effects.special+"</div>"):l.append("<div>"+BDOdatabase.stats[f].title+" "+BDOcalculator.getItemStat(e,f,!0,p)+BDOdatabase.stats[f].symbol+"</div>"));else l.append("<div>None.</div>");if(l.appendTo(d),l=$('<div class="item-set-effects"/>'),l.append("<strong>Set Effects</strong>"),"undefined"!=typeof BDOdatabase.set_effects[e.set]){if("undefined"!=typeof BDOdatabase.set_effects[e.set].combos)for(var g in BDOdatabase.set_effects[e.set].combos)if(BDOdatabase.set_effects[e.set].combos.hasOwnProperty(g)){var u=BDOdatabase.set_effects[e.set].combos[g],O="";for(var b in u.effects)u.effects.hasOwnProperty(b)&&(O+=(""===O?"<div><span>"+i(u.pieces.join(" + "))+":</span> ":" & ")+BDOdatabase.stats[b].title+" +"+u.effects[b]+BDOdatabase.stats[b].symbol);l.append(O+"</div>")}if("undefined"!=typeof BDOdatabase.set_effects[e.set].pieces)for(var v in BDOdatabase.set_effects[e.set].pieces)if(BDOdatabase.set_effects[e.set].pieces.hasOwnProperty(v)){var y=BDOdatabase.set_effects[e.set].pieces[v],O="";for(var D in y)y.hasOwnProperty(D)&&(O+=(""===O?"<div><span>"+v+"-Pieces:</span> ":" & ")+BDOdatabase.stats[D].title+" +"+y[D]+BDOdatabase.stats[D].symbol);l.append(O+"</div>")}}else l.append("<div>None.</div>");return l.appendTo(d),d.append('<div class="item-enhancement-effects"><strong>Enhancement Effects:</strong><div>'+("undefined"==typeof e.enhancement_text||""===e.enhancement_text?"Info Missing..":e.enhancement_text)+"</div></div>"),d.append('<div class="item-enhancement-level"><strong>Enhancement Level:</strong><input data-slider-min="" data-slider-max="'+n(e)+'" data-slider-value="'+p+'" class="item-enhancement-slider"></div>'),d}var m="";$(document).ready(function(){$("#player-class").select2({width:"100%",data:"undefined"==typeof $("#player-class").attr("placeholder")?BDOdatabase.classes:[$("#player-class").attr("placeholder")].concat(BDOdatabase.classes)}),s(function(e){e&&($("#player-class").val(i(m)).trigger("change.select2"),BDOcalculator.calculate(),t(),$("#calculator-section").slideDown("fast"))}),$("#player-class").on("change",function(){m=$(this).val().toLowerCase(),BDOcalculator.init(),BDOcalculator.calculate(),$(".gear-slot").each(function(e,a){r($(a).attr("data-type"),$(a).attr("data-item"))}),$("#calculator-section").slideDown("fast")}),$("#player-class-section").slideDown(),$(document).on("click",".item-choose",function(){var e=$(this).attr("data-type"),a=$(this).attr("data-item"),t=$(this).attr("data-itemset"),s=$(this).attr("data-itemno"),n=$(this).attr("data-enh");$("#gearlist").modal("hide"),c(a,e,t,s,n)}),$("#equipment .gear-slot").click(function(){var e=$("<div/>"),a=$(this).attr("data-type"),t=$(this).attr("data-itemset"),s=$(this).attr("data-item"),n=BDOdatabase.items[t],i="undefined"==typeof n[m]?n:n[m],r=1;$("#gearlist .modal-body .row").html("");for(var o in i)if(i.hasOwnProperty(o)){var c=i[o],d=!1;$.inArray(a,["ring","earring"])!==-1?BDOcalculator.gear[a+"s"][s].item_name===o&&(d=!0):BDOcalculator.gear[a].item_name===o&&(d=!0),l(c,a,t,s,o,r,d).appendTo("#gearlist .modal-body .row"),r%2===0&&$('<div class="clearfix"></div>').appendTo("#gearlist .modal-body .row"),r++}$(".item-enhancement-slider").each(function(e,a){"0"===$(a).attr("data-slider-max")?$(a).replaceWith("<div>None</div>"):$(a).slider({tooltip_position:"bottom",formatter:function(e){return"+"+e}}).on("change",function(e){var a=$(e.target).closest(".item-details"),t=$(e.target).closest(".item-details").find(".item-choose"),s=t.attr("data-item"),n=t.attr("data-type"),i=t.attr("data-itemset"),r=t.attr("data-itemno"),o=BDOdatabase.items[i],c="undefined"==typeof o[m]?o:o[m];c=c[s],t.attr("data-enh",e.value.newValue);var d=$('<div class="item-effects"/>');if(d.append("<strong>Item Effects</strong>"),Object.keys(c.item_effects).length>0)for(var l in c.item_effects)c.item_effects.hasOwnProperty(l)&&("special"===l?d.append("<strong>"+BDOdatabase.stats[l].title+":</strong><div>"+c.item_effects.special+"</div>"):"boolean"==typeof BDOdatabase.stats[l]?d.append("<div>"+BDOdatabase.stats[l].title+BDOdatabase.stats[l].symbol+"</div>"):d.append("<div>"+BDOdatabase.stats[l].title+" "+BDOcalculator.getItemStat(c,l,!0,e.value.newValue)+BDOdatabase.stats[l].symbol+"</div>"));else d.append("<div>None.</div>");a.find(".item-effects").replaceWith(d),d=$('<div class="item-stats"/>'),"undefined"!=typeof c.ap&&d.append("<div>AP: "+BDOcalculator.getItemStat(c,"ap",!1,e.value.newValue)+"</div>"),"undefined"!=typeof c.ap_min&&d.append("<div>AP: "+BDOcalculator.getItemStat(c,"ap_min",!1,e.value.newValue)+"~"+BDOcalculator.getItemStat(c,"ap_max",!1,e.value.newValue)+"</div>"),"undefined"!=typeof c.dp&&d.append("<div>DP: "+BDOcalculator.getItemStat(c,"dp",!1,e.value.newValue)+"</div>"),a.find(".item-stats").replaceWith(d)})}),$("#gearlist").modal()}),$("#equipment .gem-slot").click(function(){var e=$("<div/>"),a=$(this).attr("data-type"),t=$(this).attr("data-item"),s=$.extend({},BDOdatabase.gems.all,BDOdatabase.gems[a]),n=1;$("#gearlist .modal-body .row").html("");for(var i in s)if(s.hasOwnProperty(i)){var r=s[i],o=!1;BDOcalculator.gear[a].gems[t].gem_name===i&&(o=!0),d(r,a,t,i,n,o).appendTo("#gearlist .modal-body .row"),n%2===0&&$('<div class="clearfix"></div>').appendTo("#gearlist .modal-body .row"),n++}$("#gearlist").modal()});var e=new Clipboard("#copy-button");$("#copy-button").tooltip(),$("#copy-button").bind("click",function(){$("#copy-button").trigger("copied",["Copied!"])}),$("#copy-button").bind("copied",function(e,a){$(this).attr("title",a).tooltip("fixTitle").tooltip("show").attr("title","Copy Link").tooltip("fixTitle")})})}(jQuery);